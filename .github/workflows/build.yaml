name: "Build configurations"
on:
  pull_request:
  push:
jobs:
  tests:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
    - name: Install Nix
      uses: cachix/install-nix-action@v17
      with:
        extra_nix_config: |
          access-tokens = github.com=${{ secrets.GITHUB_TOKEN }}
          substituters = https://mic92.cachix.org https://nix-community.cachix.org https://nrdxp.cachix.org
          trusted-public-keys = mic92.cachix.org-1:gi8IhgiT3CYZnJsaW7fxznzTkMUOn1RY4GmXdT/nXYQ= nix-community.cachix.org-1:mB9FSh9qf2dCimDSUo8Zy7bkq5CX+/rkCWyvRCYg3Fs= nrdxp.cachix.org-1:Fc5PSqY2Jm1TrWfm88l6cvGWwz3s93c6IOifQWnhNW4=
    - name: Init cachix
      uses: cachix/cachix-action@v10
      with:
        name: truelecter
        authToken: '${{ secrets.CACHIX_AUTH_TOKEN }}'
    - name: Build system for NAS
      run: nix build '.#nixosConfigurations.nas.config.system.build.toplevel'
    - name: Build system for Klipper on RPI 4
      run: nix build '.#nixosConfigurations.octoprint.config.system.build.toplevel'
    - name: Build system for Mac Book
      run: nix build '.#darwinConfigurations.squadbook.config.system.build.toplevel'